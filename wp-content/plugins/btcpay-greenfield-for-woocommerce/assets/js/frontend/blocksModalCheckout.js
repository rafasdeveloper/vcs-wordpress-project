let isProcessingOrder=!1,lastExecutionTime=0;const debounceInterval=1e3;wp.data.subscribe((()=>{const e=Date.now();if(!(e-lastExecutionTime<1e3)&&wp.data.select(wc.wcBlocksData.CHECKOUT_STORE_KEY).isBeforeProcessing()&&!isProcessingOrder){isProcessingOrder=!0,lastExecutionTime=e;const t=wp.data.select(wc.wcBlocksData.PAYMENT_STORE_KEY).getState().activePaymentMethod;if(t.startsWith("btcpaygf_")){let e=blocksProcessOrder(t);return e?(blocksShowBTCPayModal(e),isProcessingOrder=!1,!1):(blocksSubmitError(BTCPayWP.textProcessingError),isProcessingOrder=!1,!1)}return!0}}));const blocksProcessOrder=function(e){let t=null,o={action:"btcpaygf_modal_blocks_checkout",orderId:wp.data.select(wc.wcBlocksData.CHECKOUT_STORE_KEY).getOrderId(),paymentGateway:e,apiNonce:BTCPayWP.apiNonce};return jQuery.ajaxSetup({async:!1}),jQuery.post(wc_add_to_cart_params.ajax_url,o,(function(e){e.data.invoiceId?t=e.data:e.data?blocksSubmitError(e.data):blocksSubmitError(BTCPayWP.textProcessingError)})).fail((function(){blocksSubmitError(BTCPayWP.textProcessingError),console.error("Error on ajax request 2")})),jQuery.ajaxSetup({async:!0}),t},blocksShowBTCPayModal=function(e){void 0!==e.invoiceId&&(window.btcpay.setApiUrlPrefix(BTCPayWP.apiUrl),window.btcpay.showInvoice(e.invoiceId));let t=!1;window.btcpay.onModalReceiveMessage((function(a){if(o(a.data)){if(a.data.status)switch(a.data.status.toLowerCase()){case"complete":case"paid":case"processing":case"settled":t=!0,setTimeout((function(){window.location=e.orderCompleteLink}),3e3);break;case"expired":window.btcpay.hideFrame(),submitError(BTCPayWP.textInvoiceExpired);break;case"invalid":window.btcpay.hideFrame(),submitError(BTCPayWP.textInvoiceInvalid)}}else"close"===a.data&&(!0===t&&(window.location=e.orderCompleteLink),blocksSubmitError(BTCPayWP.textModalClosed))}));const o=e=>"[object Object]"===Object.prototype.toString.call(e)},blocksSubmitError=function(e){window.wp.data.dispatch("core/notices").createErrorNotice(e,{context:"wc/checkout"}),resetCheckout()},resetCheckout=function(){wp.data.dispatch(wc.wcBlocksData.CHECKOUT_STORE_KEY).__internalSetIdle()};